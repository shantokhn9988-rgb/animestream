<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AniStream - Watch Anime</title>
    <style>
        :root { --primary: #ff4b4b; --bg: #1a1a1d; --card-bg: #2d2d30; --text: #ffffff; --text-sec: #b3b3b3; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--bg); color: var(--text); padding-bottom: 50px; }
        
        nav { background-color: #000; padding: 15px 20px; display: flex; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary); cursor: pointer; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; display: none; }
        .container.active { display: block; }

        .anime-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .anime-card { background-color: var(--card-bg); border-radius: 8px; overflow: hidden; cursor: pointer; transition: transform 0.2s; }
        .anime-card:hover { transform: translateY(-5px); }
        .anime-img { width: 100%; height: 280px; object-fit: cover; background-color: #333; }
        .anime-info { padding: 10px; }
        .anime-title { font-size: 1rem; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .video-container { position: relative; padding-bottom: 56.25%; height: 0; background: #000; border-radius: 8px; overflow: hidden; margin-bottom: 20px; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .back-btn { background-color: #333; color: white; padding: 10px 20px; border: none; cursor: pointer; margin-bottom: 15px; border-radius: 4px; }
        .loading { text-align: center; padding: 20px; color: var(--text-sec); }
    </style>
</head>
<body>

    <nav>
        <div class="logo" onclick="showPage('home')">AniStream</div>
    </nav>

    <!-- Home View -->
    <div id="home" class="container active">
        <h2 style="margin-bottom: 20px;">Trending Anime</h2>
        <div id="loadingHome" class="loading">Loading content...</div>
        <div class="anime-grid" id="animeGrid"></div>
    </div>

    <!-- Watch View -->
    <div id="watch" class="container">
        <button class="back-btn" onclick="showPage('home')">‚Üê Back to Home</button>
        <div class="video-container">
            <iframe id="videoPlayer" src="" allowfullscreen></iframe>
        </div>
        <h1 id="watchTitle" style="margin-bottom: 30px;">Anime Title</h1>
        <div style="border-top: 1px solid #333; padding-top: 20px;">
            <h3 style="margin-bottom: 15px; color: var(--text-sec);">More to Watch</h3>
            <div class="anime-grid" id="recommendationGrid"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ==========================================
        // PASTE SAME FIREBASE CONFIG HERE
        // ==========================================
        const firebaseConfig = {
  apiKey: "AIzaSyDuOFkRJwaypsF9OVtWLQoxkH2TUjNLIi8",
  authDomain: "anistream-b47b2.firebaseapp.com",
  databaseURL: "https://anistream-b47b2-default-rtdb.firebaseio.com",
  projectId: "anistream-b47b2",
  storageBucket: "anistream-b47b2.firebasestorage.app",
  messagingSenderId: "5250714998",
  appId: "1:5250714998:web:49198c94ba1ffe85ef3e57"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const ANIME_COLLECTION = "animes";
        let animeList = [];

        async function loadData() {
            try {
                const querySnapshot = await getDocs(collection(db, ANIME_COLLECTION));
                animeList = [];
                querySnapshot.forEach((doc) => {
                    animeList.push({ id: doc.id, ...doc.data() });
                });
                document.getElementById('loadingHome').style.display = 'none';
                renderHome();
            } catch (error) {
                console.error("Error:", error);
            }
        }

        window.showPage = function(pageId) {
            document.querySelectorAll('.container').forEach(el => el.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if (pageId !== 'watch') document.getElementById('videoPlayer').src = "";
        }

        function renderHome() {
            const grid = document.getElementById('animeGrid');
            grid.innerHTML = "";
            if(animeList.length === 0) { grid.innerHTML = "<p>No anime available yet.</p>"; return; }
            animeList.forEach(anime => {
                const card = document.createElement('div');
                card.className = 'anime-card';
                card.onclick = () => window.openWatch(anime.id);
                card.innerHTML = `<img src="${anime.img}" class="anime-img" onerror="this.src='https://via.placeholder.com/200x280'"><div class="anime-info"><div class="anime-title">${anime.title}</div></div>`;
                grid.appendChild(card);
            });
        }

        window.openWatch = function(id) {
            const anime = animeList.find(a => a.id === id);
            if (!anime) return;
            document.getElementById('watchTitle').innerText = anime.title;
            document.getElementById('videoPlayer').src = anime.url;
            window.scrollTo(0, 0);
            showPage('watch');
            renderRecommendations(id);
        }

        function renderRecommendations(currentId) {
            const recGrid = document.getElementById('recommendationGrid');
            recGrid.innerHTML = "";
            const others = animeList.filter(a => a.id !== currentId);
            others.forEach(anime => {
                const card = document.createElement('div');
                card.className = 'anime-card';
                card.onclick = () => window.openWatch(anime.id);
                card.innerHTML = `<img src="${anime.img}" class="anime-img" onerror="this.src='https://via.placeholder.com/200x280'"><div class="anime-info"><div class="anime-title">${anime.title}</div></div>`;
                recGrid.appendChild(card);
            });
        }

        loadData();
    </script>
</body>
</html>